name: Docker Build, Publish & Deploy

on:
  push:
    branches: 
      - main

permissions:
  contents: read
  packages: write
  
jobs:
  build_and_publish:
    runs-on: ubuntu-latest

    steps:
      - name: set lower case repo name
        run: echo "REPO_LC=${REPO,,}" >>${GITHUB_ENV}
        env:
          REPO: '${{ github.repository }}'
    
   
      - name: Checkout repository
        uses: actions/checkout@v4

         
      - name: Log in to GitHub Docker Registry/Packages
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Build Docker image
        run: docker build -t ghcr.io/$REPO_LC:latest . 
            
        # 4. Publier l'image Docker sur GitHub Packages
      - name: Publish Docker image
        run: docker push ghcr.io/$REPO_LC:latest

  # deploy on azure
  # deploy:
  #   needs: build_and_publish
  #   runs-on: ubuntu-latest

  #   steps:
  #         # 1. Vérifier le code du dépôt
          
  #     - name: Checkout repository
  #       uses: actions/checkout@v3

  #     # 2. Déployer l'application (exemple avec SSH sur un serveur distant)
                
  #     - name: TEST Deploy to server
  #       run: |
  #         echo "Deploying to server..."